
# 新版图形引擎开发需求文档

## 1. 文档引言


### 1.1 术语定义
- **实体**：图形中的基本元素，包括圆形、方形等形状及扩展元素
- **连线**：连接两个实体的线条元素，用于表示实体间关系
- **布局**：实体和连线在画布中的排列方式
- **画布**：图形展示的容器区域
- **交互**：用户通过鼠标、键盘等设备与图形进行的操作

## 2. 总体需求概述

新版图形引擎需具备以下核心能力：
1. 支持大数据量的图形渲染和展示
2. 提供丰富的实体类型和灵活的样式配置
3. 支持多种布局方式和动态布局效果
4. 提供完整的交互操作能力（选择、拖拽、缩放等）
5. 支持数据导入导出和图形导出功能
6. 保证操作流畅性和系统稳定性

## 3. 详细功能需求

### 3.1 数据上图功能

#### 3.1.1 基础功能
- 支持大数据量的实体和连线上图展示
- 保证大数据量下的渲染性能和操作流畅性

#### 3.1.2 交互状态管理
- 支持自定义交互状态配置（如disabled、active等）
- 提供两种状态控制方式：
  1. API状态控制：通过xxx.setState('状态名', 状态值)设置实体状态
  2. 样式类控制：通过xxx.addClassName('样式类名')设置实体样式
- 支持全局和单个实体的状态控制

### 3.2 实体管理功能

#### 3.2.1 实体类型
- **基础形状**：圆形、方形及其他扩展形状
- **扩展元素**：图片、文字、角标

#### 3.2.2 基础配置
- **形状配置**：
  - 圆形：支持半径大小设置
  - 方形：支持宽度、高度设置
  - 通用配置：背景色、边框宽度、边框颜色、阴影(shadow)、阴影模糊(shadowBlur)
  
- **图片配置**：
  - 尺寸设置：宽度、高度
  - 资源配置：图片地址
  - 显示控制：是否显示
  - 交互控制：可配置是否参与交互（默认支持交互）
  
- **文字配置**：
  - 样式设置：文字大小、文字颜色
  - 位置设置：默认在实体下方，可配置上、中、下、左、右五个位置
  - 偏移设置：相对于实体的水平偏移(offestX)、垂直偏移(offestY)
  - 溢出处理：超过规定字数时截断并以省略号结尾
  - 交互控制：可配置是否参与交互（默认支持交互）
  
- **角标配置**：
  - 形状设置：默认圆形
  - 内容设置：支持自定义内容（小图标、数字等）
  - 样式设置：背景色、边框、边框颜色、阴影效果(shadow)、阴影模糊(shadowBlur)
  - 交互控制：可配置是否参与交互

#### 3.2.3 交互配置
- **样式交互**：支持hover、select等状态的样式变化
- **事件交互**：支持click、dblclick等事件绑定
- **角标特殊交互**：
  - hover状态：背景色、边框、边框色、阴影效果可配置变化
  - 支持active、select等其他交互状态配置
  - 点击事件：返回当前点击对象的详细信息

### 3.3 连线管理功能

#### 3.3.1 连线类型
- 基础类型：直线、曲线、贝塞尔曲线
- 箭头设置：支持单向箭头、双向箭头、无箭头三种模式

#### 3.3.2 基础配置
- **线条样式**：
  - 宽度设置：支持自定义线条宽度
  - 颜色设置：支持自定义线条颜色
  - 线型设置：支持实线(solid)、虚线(dashed)、点线(dotted)
  
- **连线文字**：
  - 位置设置：线上、线中、线下三个位置
  - 样式设置：文字颜色、文字大小
  - 横向位置：左、中、右三个位置
  - 偏移设置：相对于连线的水平偏移(offestX)、垂直偏移(offestY)

#### 3.3.3 特殊处理
- 多连线处理：当两个实体间存在多条连线时，需保持适当间距
- 文字避免重叠：确保多条连线的文字不相互重叠

### 3.4 布局管理功能

#### 3.4.1 基础布局类型
1. **弹性布局（力导向布局）**：
   - 布局效果：实体间布局明显，避免重叠
   - 流向优化：支持左右结构，从左向右布局
   - 锚点优化：实体与连线的锚点位于左右两侧

2. **圆形布局**：实体沿圆形路径排列

3. **组织结构布局**：
   - 支持层级展示
   - 适合展示组织架构、层级关系

4. **时序布局**：
   - 按时间顺序排列
   - 适合展示时间相关的流程和关系

5. **树形布局**：
   - 支持树形层级结构
   - 可配置展开/折叠功能

#### 3.4.2 动态布局
- 动画效果：从初始状态到布局完成的过程以动画形式展示
- 动画速度：可配置动画持续时间
- 流畅性：保证动画过程不卡顿、不掉帧

#### 3.4.3 布局拓展
- 增量布局：在已布局的图形上新增实体和连线时，不改变原有布局
- 位置优化：新增实体的位置需避开已有实体，避免重叠
- 自动调整：新增元素后自动调整局部布局，保持整体美观

### 3.5 画布操作功能

#### 3.5.1 视图控制
- **自适应画布**：
  - 自动适应：操作或布局后自动调整画布大小
  - 手动调用：提供API支持手动触发自适应
  - 视图优化：确保所有元素都在可视范围内

- **缩放功能**：
  - 操作方式：支持鼠标滚轮、手势缩放
  - 清晰度保证：缩放过程中文字保持清晰
  - 缩放范围：支持最小/最大缩放比例限制

#### 3.5.2 选择操作
- **选择方式**：
  - 单个选择：点击单个实体或连线
  - 多个选择：按住Ctrl键点击多个元素
  - 框选功能：
    1. 快捷键配合：按住Shift键+鼠标拖拽
    2. 自动激活：鼠标停留约0.5秒后进入框选状态

- **选择反馈**：
  - 视觉反馈：选中元素显示明显的选中样式
  - 状态保存：保存当前选中状态，支持后续操作

#### 3.5.3 拖拽操作
- **拖拽模式**：
  - 模式切换：支持拖拽模式和非拖拽模式切换
  - 非拖拽模式：禁止拖动实体和连线

- **拖拽能力**：
  - 单个拖拽：支持单个实体或连线的拖拽
  - 批量拖拽：支持多个选中元素的同时拖拽
  - 流畅性要求：大数据量下仍保持流畅，无卡顿掉帧



### 3.6 数据操作功能

#### 3.6.1 数据导出
- **数据格式**：支持JSON格式导出
- **导出内容**：包含所有实体、连线的完整数据信息
- **导出方式**：提供按钮触发和API调用两种方式

#### 3.6.2 图片导出
- **格式支持**：PNG、JPEG等常用图片格式
- **清晰度保证**：导出图片保持高清晰度，无模糊
- **尺寸设置**：支持按当前视图大小或自定义尺寸导出
- **背景设置**：支持透明背景和自定义背景色

#### 3.6.3 数据导入（待定）
- **格式支持**：支持JSON格式导入
- **导入验证**：对导入数据进行格式验证和完整性检查
- **冲突处理**：提供覆盖、合并等冲突处理策略
- **批量导入**：支持大数据量的批量导入

### 3.7 编辑操作功能

#### 3.7.1 新增操作
- **单个新增**：支持单个实体、单个连线的新增
- **批量新增**：支持多个实体、多个连线的批量新增
- **新增配置**：新增时可配置样式、属性等信息

#### 3.7.2 删除操作
- **单个删除**：支持单个实体、单个连线的删除
- **批量删除**：支持多个选中元素的批量删除
- **删除确认**：可配置是否显示删除确认提示
- **删除恢复**：支持通过撤销操作恢复删除的元素

#### 3.7.3 显示隐藏
- **操作粒度**：支持单个、多个元素的显示/隐藏切换
- **批量操作**：支持"显示全部"、"隐藏所选"功能
- **布局影响**：隐藏的元素不参与布局计算
- **状态保存**：保存元素的显示/隐藏状态

#### 3.7.4 撤销恢复
- **支持操作**：
  - 单个操作：实体/连线的新增、删除、样式更新
  - 批量操作：批量新增、批量删除、批量样式更新
- **排除操作**：hover、select等临时样式交互不参与撤销恢复
- **历史记录**：可配置历史记录数量上限
- **操作效率**：撤销恢复操作响应迅速，无明显延迟

### 3.8 搜索筛选功能

#### 3.8.1 搜索能力
- **搜索对象**：支持实体、连线的搜索
- **搜索粒度**：支持单个搜索和分类搜索
- **搜索条件**：
  - 基础条件：ID、名称等属性
  - 状态条件：选中(select)状态等
- **搜索反馈**：搜索结果高亮显示(待定)

#### 3.8.2 筛选功能
- **筛选方式**：支持回调函数自定义筛选逻辑
- **多条件筛选**：支持组合多个筛选条件
- **筛选保存**：支持保存常用筛选条件
- **实时筛选**：支持输入时实时更新筛选结果

#### 3.9 鹰眼图
- **功能定位**:确保鹰眼图与主画布的视图状态、内容信息完全一致，无延迟、无偏差，避免用户因信息不同步产生操作误解。
- **要求** 
  - 视图状态同步：主画布发生平移、缩放、旋转操作时，鹰眼图内的 “当前视口框”（标识主画布可见范围）需实时更新位置、尺寸与角度，同步延迟≤100ms，无明显卡顿。
  - 内容信息同步：主画布新增 / 删除实体、修改实体样式（颜色、大小、图标）、调整连线状态（线型、颜色、是否显示箭头）时，鹰眼图需同步更新对应内容，无内容缺失、样式错乱或显示延迟。
  - 视口框标识优化：“当前视口框” 采用 “2px 加粗主题色边框 + 30% 透明度主题色背景” 设计，既清晰区分当前视图范围，又不遮挡鹰眼图内的全局画布内容，提升视觉辨识度。



## 4. 非功能需求

#### 4.1 渲染性能
- 大数据量支持：至少支持1000个实体+2000条连线的流畅渲染
- 加载速度：初始加载时间不超过3秒（1000个实体规模）
- 帧率要求：操作过程中保持60fps以上的帧率


